<!DOCTYPE html> 
<html>
<head>
<title>Endless Mode</title>
<style>
.yellow {color:yellow;}
.white {color:white;}
.blend {background-color:black;color:white;border-color:black;}
.fly-sprite { width: 20px; height: 20px; }
.green-fly { width: 20px; height: 20px;}
@font-face { font-family: 'DeterminationMono'; src: url('font/DeterminationMonoWebRegular-Z5oq.ttf') format('truetype'); }
body {height:100vh; margin: 0; background-color:black; position: relative; font-family: 'DeterminationMono', monospace; }
#gameContainer {width: 1050px; position: absolute; bottom: 50px; left: 400px; display: flex; flex-direction: column; box-sizing: border-box;}
#textBox {border: solid white; border-width: 12px; background-color: black; position: relative; height: 225px; width: 1050px; margin: 15px auto; color: white; font-size: 32px; padding: 20px; box-sizing: border-box; word-wrap: break-word; overflow-y: hidden; line-height: 1.4; }
#enemyContainer { position: relative; height: 600px; width: 800px; margin: 0px auto 15px auto; border-width: 12px; box-sizing: border-box;}
#menuBox {width: 1050px; height: 75px; margin: 10px auto 15px auto; display: flex; justify-content: space-around; }
#hp-section { display: flex; justify-content: center; color: white; font-family: 'DeterminationMono', monospace; margin-top: 0px;}
#hp-display-group { display: flex; flex-direction: column; align-items: center; margin-left: 30px;}
#hp-container { width: 300px; height: 60px; background-color: #c00; margin: 0 10px;}
#hp-bar { width: 100%; height: 100%; background-color: #ffff00;}
#hp-text { font-size: 48px; }
#enemy { width: 116px; height: 111px; position: absolute; top: 500px; left: 335px;}
#score-group { display: flex; flex-direction: column; align-items: center; margin-top: 10px;}
</style>
</head>
<body style="background-color:black; position: relative;">
<div id="debugMenu" style="position: fixed; top: 10px; right: 10px; background: rgba(0,0,0,0.8); color: lime; font-family: monospace; padding: 10px; border: 1px solid lime; z-index: 1000; font-size: 14px; pointer-events: none;">
</div>
<div id="gameContainer">
<div id="enemyContainer">
<img id="enemy" src="sprites/froggit.gif">
</div>
<img src="sprites/soul-01.png" width="32" height="32" id="myPlayer01" style="position: absolute; left: 284px; top: 134px; opacity: 1.0; z-index: 100;">
<div id="textBox">
</div>
<img id="attackBar" src="sprites/attackbar.gif" style="position: absolute; display: none; width: 14px; height: 200px; z-index: 10;">
<img id="attackZone" src= "sprites/attackzone.png" style="position: absolute; display: none; z-index: 5;">
<div id="hp-section"> 
<div id="hp-display-group">
<div id="hp-text-wrapper">
<span style="font-size:48px;">HP:</span>
<span id="hp-text">20 / 20</span>
</div>
<div id="hp-container">
<div id="hp-bar"></div>
</div>
<div id="score-group" style="display: flex; flex-direction: column; align-items: center;">
<span id="scoreDisplay" style="font-size:48px;">Score: 0</span>
<span id="highScoreDisplay" style="font-size:48px; color: gold;">Best: 0</span>
</div>
</div>
<div id="menuBox">
<img id="fightBtn" src="sprites/fight.png" height="84" width="220">
<img id="actBtn" src="sprites/act.png" height="84" width="220">
<img id="itemBtn" src="sprites/item.png" height="84" width="220">
<img id="mercyBtn" src="sprites/mercy.png" height="84" width="220">
</div>
</div>
<script>
let enemyContainer = document.getElementById('enemyContainer');
let textBox = document.getElementById('textBox');
let menuBox = document.getElementById('menuBox');
let gameContainer = document.getElementById('gameContainer');
let playerElement = document.getElementById('myPlayer01');
let enemy = document.getElementById('enemy');
let attackBar = document.getElementById('attackBar');
let attackZone = document.getElementById('attackZone');
let maxHoriz = 568;
let maxVerti = 268;
let showDebug = false;
let wMenuKeyDebounced = false;
let aMenuKeyDebounced = false;
let sMenuKeyDebounced = false;
let dMenuKeyDebounced = false;
let actionKeyDebounced = false;
let isTyping = false;
let isMenuPhase = true;
let isAttacking = false;
let isActMenuPhase = false;
let isTargettingAct = false;
let isItemMenuPhase = false;
let isActionActive = false;
let isMercyChoice = false;
let isEnemyTurn = false;
let isWaitingToStart = false;
let isCheating = false;
let victory = false;
let hasAttacked = false;
let myHoriz;
let myVerti;
let up = false;
let down = false;
let right = false;
let left = false;
let currentMenuItem = 1;
let currentActItem = 1;
let currentItem = 1;
let currentMercyItem = 1;
let actionKeyPressed = false;
let maxHealth = 20;
let playerHealth = 20;
let score = 0;
let highScore = localStorage.getItem('endlessHighScore') || 0;
let inventory = ['Monster Candy','Monster Candy','Monster Candy','Monster Candy','Bandage']
let enemyHealth = 20;
let enemyATK = 10;
let enemyDEF = 10;
let enemyMercy = 0;
let enemyDialogue = false;
let turnNum = 0;
let isInvincible = false;
let battleInitiated = false;
let boxRect = textBox.getBoundingClientRect();
let containerRect = gameContainer.getBoundingClientRect();
let bullets = [];
let flySpawner;
let flyTimer = 375;
let boxLeft;
let boxTop;
let barPosition = 0;
let moveBarID;
let targetCenter = 480;
document.getElementById('highScoreDisplay').innerHTML = 'Best: ' + highScore;
function writeText(dialogue, callback, index = 0) {
if (index === 0) {
if (isTyping) return;
isTyping = true;
textBox.innerHTML = '';
}
if (index >= dialogue.length) {
isTyping = false;
if (callback) callback(); 
return;
}
let delay = 50;
if (dialogue.substring(index, index + 4) === '<br>') {
textBox.innerHTML += '<br>';
index += 4;
delay = 0;
} else {
textBox.innerHTML += dialogue[index];
index += 1;
}
setTimeout(function() {
writeText(dialogue, callback, index);
}, delay);
}
function startBattle() {
writeText("* Press Z or Enter to start Endless Mode...");
menuBox.style.display = 'none'; 
if (!battleInitiated) {
setInterval(movement, 10);
battleInitiated = true;
}
isWaitingToStart = true; 
}
document.onkeydown = function(event){
if (event.key === "z" || event.key === "Enter"){
if (isTyping){return;} else{
if (isWaitingToStart) {
startEnemyTurn();
isWaitingToStart = false;
}
else {return;}
}
}
if (event.key === "w"){
up = true;
}
if (event.key === "s"){
down = true;
}
if (event.key === "a"){
left = true;
}
if (event.key === "d"){
right = true;
}
if (event.ctrlKey && event.key === "q"){
showDebug = !showDebug;
const debugElement = document.getElementById('debugMenu');
if (showDebug) {
debugElement.style.display = 'block';
} else {debugElement.style.display = 'none';}
}    
}
document.onkeyup = function(event){
if (event.key === "w"){up = false; wMenuKeyDebounced = false;}
if (event.key === "s"){down = false; sMenuKeyDebounced = false;}
if (event.key === "a"){left = false; aMenuKeyDebounced = false;}
if (event.key === "d"){right = false; dMenuKeyDebounced = false;}
}
function movement() {
updateDebug();
if (isEnemyTurn) {
if (up) { myVerti -= 3; }
if (down) { myVerti += 3; }
if (left) { myHoriz -= 3; }
if (right) { myHoriz += 3; }
if (myHoriz < 0) { myHoriz = 0; }
if (myHoriz > maxHoriz) { myHoriz = maxHoriz; }
if (myVerti < 0) { myVerti = 0; }
if (myVerti > maxVerti) { myVerti = maxVerti; }
moveBullets();
playerElement.style.top = myVerti + 'px';
playerElement.style.left = myHoriz + 'px';
}
}
function updateDebug() {
const debugElement = document.getElementById('debugMenu');
if (!showDebug){debugMenu.style.display = 'none'}
else if (showDebug){debugMenu.style.display = 'block'}
if (!debugElement) return;
debugElement.innerHTML = `
---------------- <br>
Game Variables<br>
Fly spawnrate: ${flyTimer}<br>
Dialogue typing?: ${isTyping}<br>
Waiting to start?: ${isWaitingToStart}<br>
Cheats?: ${isCheating}<br>
---------------- <br>
Player Variables<br>
Up: ${up}<br>
Left: ${left}<br>
Down: ${down}<br>
Right: ${right}<br>
X: ${myHoriz}<br>
Y: ${myVerti}<br>
Health: ${playerHealth}<br>
`;
}
function updateUI() {
let healthPercent = (playerHealth / maxHealth) * 100;
if (healthPercent < 0) {
healthPercent = 0;
}
let hpBar = document.getElementById("hp-bar");
hpBar.style.width = healthPercent + "%";
let hpText = document.getElementById("hp-text");
hpText.innerText = playerHealth + " / " + maxHealth;
}
function takeDamage(damageAmount) {
if (!isInvincible && playerHealth > 0) {
playerHealth -= damageAmount;
updateUI();
if (playerHealth <= 0) {
playerHealth = 0;
updateUI();
playerDeath();
return;
}
isInvincible = true;
playerElement.style.opacity = 0.5;
setTimeout(function() {
isInvincible = false;
playerElement.style.opacity = 1.0;
}, 1000);
}
}
function startEnemyTurn() {
if (isEnemyTurn) return;
if (flyTimer > 375 || flyTimer < 100){ isCheating = true; console.log('Why you cheat? :('); textBox.style.borderColor = 'red'; }
clearInterval(flySpawner);
enemyDialogue = false;
isActionActive = true;
isAttacking = false;
hasAttacked = false;
turnNum = 1;
bullets = [];
textBox.innerHTML = '';
textBox.style.width = "200px";
textBox.style.height = "200px";
textBox.style.margin = "0 auto";
textBox.style.overflow = 'hidden';
textBox.appendChild(playerElement);
maxHoriz = 143;
maxVerti = 143;
myHoriz = 84; 
myVerti = 84;
playerElement.style.left = myHoriz + 'px';
playerElement.style.top = myVerti + 'px';
flySpawner = setInterval(spawnFly, flyTimer);
setInterval(increaseDifficulty, 7500);
isEnemyTurn = true;
}
function spawnFly() {
let fly = document.createElement('img');
fly.style.position = 'absolute';
let randomX = Math.random() * 160;      
fly.style.left = randomX + 'px';
fly.style.top = '-20px';
textBox.appendChild(fly);
bullets.push({
element: fly,
x: randomX,
y: -20
});
let isGreen = Math.random() < 0.15;
if (isGreen) {
fly.src = 'sprites/froggit-heal-fly.gif';
fly.classList.add('green-fly');
} else {
fly.src = 'sprites/froggit-attack-fly.gif';
fly.classList.add('fly-sprite');
}
}
function moveBullets() {
bullets.forEach(fly => {
fly.y += 3;
fly.element.style.top = fly.y + 'px';
if (fly.y > 200) {
fly.element.remove();
increaseScore();
}
if (!isInvincible) {
if (fly.x + 10 > myHoriz + 2 && 
fly.x + 10 < myHoriz + 30 &&
fly.y + 10 > myVerti + 2 && 
fly.y + 10 < myVerti + 30) {
if (fly.element.classList.contains('green-fly')) {
playerHealth += 3;
if (playerHealth > 20) { playerHealth = 20; }
updateUI();
fly.element.remove();
fly.removed = true;
} else {
takeDamage(3);
fly.element.remove();
fly.removed = true;
}
}
}
});
bullets = bullets.filter(fly => fly.y <= 200 && !fly.removed);
}
function increaseDifficulty() {
if (isCheating){return;}
if (flyTimer > 100){
flyTimer -= 25
clearInterval(flySpawner)
flySpawner = setInterval(spawnFly, flyTimer)
}
else {return;}
}
function increaseScore() {
if (isCheating){return;}
else {
score += 1
document.getElementById('scoreDisplay').innerHTML = 'Score:' + score;
if (score > highScore) {
highScore = score; 
document.getElementById('highScoreDisplay').innerHTML = 'Best:' + highScore; 
localStorage.setItem('endlessHighScore', highScore);
}
}
}
function playerDeath() {
if (score > highScore) {localStorage.setItem('endlessHighScore', score);}
location.href = 'gameover-endless.html';
}
startBattle();
</script>
</body>
</html>
